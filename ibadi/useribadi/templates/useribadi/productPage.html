{% extends 'useribadi/base.html' %}

{% load static %}

{% block customCss %}
{{ block.super }}
<style>
    .bg-dark-custom {
        background-color: var(--secondary-color);
        border: 1px solid var(--yellow-color);
    }
    .btn-warning-outline {
        color: var(--yellow-color);
        border-color: var(--yellow-color);
        background-color: transparent;
    }
    .btn-warning-outline:hover {
        background-color: var(--yellow-color);
        color: var(--dark-color);
    }
    .related-product-card {
        transition: transform 0.3s ease-in-out;
    }
    .related-product-card:hover {
        transform: scale(1.05);
    }
    .thumbnail-image {
        cursor: pointer;
        transition: opacity 0.3s ease-in-out;
    }
    .thumbnail-image:hover {
        opacity: 0.7;
    }
    .product-section {
        background-color: var(--secondary-color);
        border: 1px solid var(--yellow-color);
        border-radius: 0.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    .product-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }
    .product-price {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
    }
    .product-description {
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 2rem;
    }
    .action-buttons .btn {
        width: 100%;
    }
    .tab-button {
        background-color: transparent;
        color: var(--yellow-color);
        border: 1px solid var(--yellow-color);
        padding: 0.5rem 1rem;
        margin: 0 0.5rem;
        border-radius: 0.25rem;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
    }
    .tab-button.active {
        background-color: var(--yellow-color);
        color: var(--dark-color);
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
    .stock-status {
        font-size: 0.8rem;
        font-weight: 600; 
        padding: 0.3rem 0.6rem; 
        border-radius: 0.25rem; 
        text-transform: uppercase; 
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row g-4">
        <!-- Product Images -->
        <div class="col-lg-6">
            <div class="product-section">
                <div class="row">
                    <div class="col-3">
                        {% for image in images %}
                        <img src="{{ image.images.url }}" 
                             class="img-fluid mb-3 rounded border border-warning thumbnail-image" 
                             alt="Thumbnail"
                             onclick="changeMainImage('{{ image.images.url }}')">
                        {% endfor %}
                    </div>
                    <div class="col-9">
                        {% if mainImage %}
                        <img id="mainImage" 
                             src="{{ mainImage.images.url }}" 
                             class="img-fluid rounded shadow-lg" 
                             alt="{{ product.product_name }}">
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-lg-6">
            <div class="product-section">
                <h1 class="product-title fw-bold text-warning">{{ product.product_name }}</h1>
                <div class="product-price">
                    {% if product.regular_price > product.selling_price %}
                    <span class="text-warning fs-3 fw-bold">
                        &#8377; {{ product.selling_price }}
                    </span>
                    <span class="text-danger fs-4 fw-bold ms-2">
                        <del>&#8377; {{ product.regular_price }}</del>
                    </span>
                    {% else %}
                    <span class="text-warning fs-3 fw-bold">&#8377; {{ product.selling_price }}</span>
                    {% endif %}
                </div>

                <!-- Stock Availability -->
                <div class="mb-3">
                    {% if product.quantity == 0 %}
                    <span class="badge stock-status text-white bg-danger">
                        Out of Stock
                    </span>
                    {% else %}
                    <span class="badge stock-status text-white bg-success">
                        In Stock
                    </span>
                    {% endif %}
                </div>

                <p class="product-description text-white">{{ product.short_description }}</p>

                <!-- Variant Selection -->
                <div class="mb-4">
                    <h5 class="text-warning mb-3">Select Variant</h5>
                    <form id="variantForm">
                        <div class="btn-group w-100" role="group">
                            {% for variant in variants %}
                            <input 
                                type="radio" 
                                class="btn-check" 
                                id="variant{{ variant.variant_id }}" 
                                name="variant_selection" 
                                value="{% url 'productPage' variant.product_id variant.variant_id %}" 
                                {% if variant.variant_id == product.variant.variant_id %}checked{% endif %}
                                onchange="updateProductPage(this.value)">
                            <label class="btn btn-warning-outline text-warning" for="variant{{ variant.variant_id }}">
                                {{ variant.variant.variant_name }}
                            </label>
                            {% endfor %}
                        </div>
                    </form>
                </div>

                <!-- Add to Cart and Wishlist -->
                <div class="action-buttons row g-2">
                    <div class="col-6">
                        <form method="POST" action="{% url 'addToCart' product.product_id %}">
                            {% csrf_token %}
                            <input type="hidden" name="variant_id" value="{{ product.variant.variant_id }}">
                            {% if product.quantity > 0 %}
                            <button type="submit" class="btn btn-warning fw-bold">
                                <i class="fas fa-shopping-cart me-2"></i>Add to Cart
                            </button>
                            {% else %}
                            <button type="button" class="btn btn-secondary fw-bold" disabled>
                                <i class="fas fa-shopping-cart me-2"></i>Out of Stock
                            </button>
                            {% endif %}
                        </form>
                    </div>
                    <div class="col-6">
                        <form method="POST" action="{% url 'addToWishlist' product.product_id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-warning">
                                <i class="fas fa-heart me-2"></i>Add to Wishlist
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Description and Reviews Section -->
    <div class="product-section mt-5">
        <div class="text-center mb-4">
            <button class="tab-button active" onclick="showTab('description')">Description</button>
            <button class="tab-button" onclick="showTab('reviews')">Reviews</button>
        </div>
        <div id="description" class="tab-content active">
            <h3 class="text-warning mb-3">Product Description</h3>
            <p class="text-white">{{ product.description }}</p>
        </div>
        <div id="reviews" class="tab-content">
            <h3 class="text-warning mb-3">Customer Reviews</h3>
            {% if reviews %}
                {% for review in reviews %}
                <div class="mb-4">
                    <h5 class="text-warning">{{ review.user.username }}</h5>
                    <div class="text-white">
                        {% for i in review.rating|ljust:5 %}
                            {% if i == '1' %}
                                <i class="fas fa-star text-warning"></i>
                            {% else %}
                                <i class="far fa-star text-warning"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <p class="text-white mt-2">{{ review.comment }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-white">No reviews yet. Be the first to review this product!</p>
            {% endif %}
        </div>
    </div>

    <!-- Related Products -->
    <div class="product-section mt-5">
        <h3 class="text-warning mb-4">Related Products</h3>
        <div class="row g-4">
            {% for related_product in related_products %}
            <div class="col-md-3">
                <div class="card bg-dark-custom h-100 text-center border border-warning related-product-card">
                    <a href="{% url 'productPage' related_product.id related_product.variant_id %}">
                        <img src="{{ related_product.relatedImageUrl }}" 
                             class="card-img-top" 
                             alt="{{ related_product.name }}">
                    </a>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-warning">{{ related_product.name }}</h5>
                        <p class="text-white mt-auto">&#8377; {{ related_product.price }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    function updateProductPage(url) {
        window.location.href = url; // Redirect to the selected variant's URL
    }

    function changeMainImage(imageUrl) {
        document.getElementById('mainImage').src = imageUrl;
    }

    function showTab(tabName) {
        // Hide all tab contents
        var tabContents = document.getElementsByClassName('tab-content');
        for (var i = 0; i < tabContents.length; i++) {
            tabContents[i].classList.remove('active');
        }

        // Deactivate all tab buttons
        var tabButtons = document.getElementsByClassName('tab-button');
        for (var i = 0; i < tabButtons.length; i++) {
            tabButtons[i].classList.remove('active');
        }

        // Show the selected tab content
        document.getElementById(tabName).classList.add('active');

        // Activate the clicked tab button
        event.currentTarget.classList.add('active');
    }
</script>
{% endblock %}
